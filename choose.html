<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />
    <script src="jquery.min.js"></script>
	<script src="people.js"></script>
    <link rel="stylesheet" href="choose.css">
</head>
<body>
    <div class="buttonHolder2">
	<span class="categ">Categories</span>
        <button type="button" onclick="loadGame(this)" data-target="all">
			<div>
				<span class="levelName">All Levels</span>
				<div class="level">
					<div class="levelReader" id="MascotsLevelTotal"></div>
				</div>
				<div class="showScore" id="MascotsLevelTotalScore"></div>
                <div class="showScore" id="MascotsLevelTotalGrade"></div>
			</div>
		</button>
        <button type="button" onclick="loadGame(this)" data-target="CEC">
			<div>
				<span class="levelName">CEC Members</span>
				<div class="level">
					<div class="levelReader" id="CECTotal"></div>
				</div>
				<div class="showScore" id="CECTotalScore"></div>
                <div class="showScore" id="CECTotalGrade"></div>
			</div>
		</button>
        <button type="button" onclick="loadGame(this)" data-target="Musicians">
			<div>
				<span class="levelName">Musicians</span>
				<div class="level">
					<div class="levelReader" id="MusiciansTotal"></div>
				</div>
				<div class="showScore" id="MusiciansTotalScore"></div>
                <div class="showScore" id="MusiciansTotalGrade"></div>
			</div>
		</button>  
	<button type="button" onclick="loadGame(this)" data-target="themeofyear">
			<div>
				<span class="levelName">Theme Of The Year</span>
				<div class="level">
					<div class="levelReader" id="themeofyearTotal"></div>
				</div>
				<div class="showScore" id="themeofyearTotalScore"></div>
                <div class="showScore" id="themeofyearTotalGrade"></div>
			</div>
		</button> 
    </div>
    <script>
    	var CECTotalNumber = 0;
    	var MusiciansTotalNumber = 0;
	var themeofyearTotalNumber = 0; 
    	var allLevels = people.length;
        var highest = 4;
        
        function loadGame(button){
        	var cat = $(button).attr("data-target");
		if(cat == "all"){
			cat = "MascotsLevel";
			var chosenCatLevel = localStorage.getItem(cat);
			if(chosenCatLevel != null){
				if(chosenCatLevel == people.length){
					var startAgain = confirm("Game completed, Do you want to start again?");
				if(startAgain){
					localStorage.removeItem("MascotsLevel");
					localStorage.removeItem("MascotsLevel" + "Total");
                    localStorage.removeItem("MascotsLevel" + "TotalGrade");
					window.location.href = "index.html";
				   }else{
					   return;
				   }
				}
			}
			window.location.href = "index.html";
			return;
		}
			var chosenCatLevel = localStorage.getItem(cat);
			if(chosenCatLevel != null){
				//var reversedPeople = parseInt(people.slice().reverse().findIndex(b => b.category === cat));
				//var count = people.length - 1;
				//var finalIndex = count - reversedPeople;
                var finalIndex = findLast(cat);
			 if(finalIndex < chosenCatLevel){
				var startAgain = confirm(cat + " category completed, Do you want to start again?");
				if(startAgain){
					localStorage.removeItem(cat);
					localStorage.removeItem(cat + "Total");
                    localStorage.removeItem(cat + "TotalGrade");
					window.location.href = "index.html?"+cat;
				     }else{return;}
				}
			}
            window.location.href = "index.html?"+cat;
           }
           $(document).ready(function () {
           	countNumber();
           	var AllLevels = checkValue("MascotsLevelTotal");
           	var MusiciansLevels = checkValue("MusiciansTotal");
           	var CECLevels = checkValue("CECTotal");
		var themeofyearLevels = checkValue("themeofyearTotal");

           });

			function checkValue(value) {
				var result = localStorage.getItem(value);
                var myGrade = localStorage.getItem(value + "Grade");
				var percent;
				var grandTotal;
				result = result == null ? 0 : parseInt(result);
                myGrade = myGrade == null ? 0 : parseInt(myGrade);
				if(value == "MascotsLevelTotal") {				
						percent = (result / parseInt(allLevels));
						grandTotal = allLevels;
				}else if(value == "CECTotal"){				
						percent = (result / parseInt(CECTotalNumber));
						grandTotal = CECTotalNumber;
				}else if(value == "MusiciansTotal"){
						percent = (result / parseInt(MusiciansTotalNumber));
						grandTotal = MusiciansTotalNumber;
				}else if(value == "themeofyearTotal"){
						percent = (result / parseInt(themeofyearTotalNumber));
						grandTotal = themeofyearTotalNumber;
				}
					percent = (percent * 100).toFixed(0);
					var color;
					if(percent <= 30){
						color = "red";
					}else if((percent > 30) && (percent <= 70)){
						color = "darkorange";
					}else{
						color = "green";
					}
                    var maxGrade = grandTotal * highest;
				$("#" + value).css("width", percent + "%");
				$("#" + value).css("background", color);
				$("#" + value + "Score").html("Passed: " + result + " / " + grandTotal);
                $("#" + value + "Grade").html("Grade: " + myGrade + " / " + maxGrade);
		}

			function countNumber() {				
				for (var i = 0; i < people.length; i++) {
					if (people[i].category == "CEC") {
						CECTotalNumber += 1;
					}
					if (people[i].category == "Musicians") {
						MusiciansTotalNumber += 1;
					}
					if (people[i].category == "themeofyear") {
						themeofyearTotalNumber += 1;
					}
				}
			}
        
        function findLast(cat){
            var spot;
            for(var i = people.length - 1; i > 0; i--){
                if(people[i].category == cat){
                    spot = i;
                    break;
                }
            }
            return spot;
        }
	</script>
</body>
</html>
